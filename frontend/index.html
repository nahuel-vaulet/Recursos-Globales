<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- SEO -->
    <title>ERP Recursos Globales</title>
    <meta name="description"
        content="Sistema ERP para gestión de recursos, ODTs, stock y personal — Recursos Globales Business Company">

    <!-- PWA -->
    <meta name="theme-color" content="#0d1b2a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- App CSS -->
    <link rel="stylesheet" href="assets/css/app.css">
</head>

<body data-theme="dark">

    <!-- App Shell: Hidden when on login page -->
    <div id="app-shell">
        <!-- ─── Header ─────────────────────────────── -->
        <header class="navbar" id="app-header">
            <div class="navbar-inner">
                <div class="navbar-brand">
                    <button class="sidebar-toggle"
                        onclick="document.getElementById('app-sidebar').classList.toggle('open')"
                        aria-label="Toggle sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <span class="brand-text">Recursos Globales</span>
                </div>

                <div class="navbar-actions">
                    <!-- Theme Toggle -->
                    <button class="icon-btn" onclick="toggleTheme()" title="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>

                    <!-- User Menu -->
                    <div class="user-dropdown" id="userDropdown">
                        <button class="user-btn" onclick="this.parentElement.classList.toggle('open')">
                            <div class="user-avatar" id="userAvatar">?</div>
                            <div class="user-info">
                                <div class="user-name" id="userName">Cargando...</div>
                                <div class="user-role" id="userRole"></div>
                            </div>
                            <i class="fas fa-chevron-down" style="font-size:0.7em; opacity:0.6;"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#/" class="dropdown-item"><i class="fas fa-home"></i> Dashboard</a>
                            <div class="dropdown-divider"></div>
                            <a href="javascript:void(0)" class="dropdown-item" onclick="AuthManager.logout()">
                                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ─── Sidebar ────────────────────────────── -->
        <aside class="sidebar" id="app-sidebar">
            <nav class="sidebar-nav">
                <a href="#/" class="sidebar-link active" data-module="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#/odt" class="sidebar-link" data-module="odt">
                    <i class="fas fa-clipboard-list"></i>
                    <span>ODTs</span>
                </a>
                <a href="#/stock" class="sidebar-link" data-module="stock">
                    <i class="fas fa-boxes"></i>
                    <span>Stock</span>
                </a>
                <a href="#/cuadrillas" class="sidebar-link" data-module="cuadrillas">
                    <i class="fas fa-users-cog"></i>
                    <span>Cuadrillas</span>
                </a>
                <a href="#/vehiculos" class="sidebar-link" data-module="vehiculos">
                    <i class="fas fa-truck"></i>
                    <span>Vehículos</span>
                </a>
                <a href="#/combustibles" class="sidebar-link" data-module="combustibles">
                    <i class="fas fa-gas-pump"></i>
                    <span>Combustibles</span>
                </a>
                <a href="#/herramientas" class="sidebar-link" data-module="herramientas">
                    <i class="fas fa-tools"></i>
                    <span>Herramientas</span>
                </a>
                <a href="#/proveedores" class="sidebar-link" data-module="proveedores">
                    <i class="fas fa-handshake"></i>
                    <span>Proveedores</span>
                </a>
                <a href="#/partes" class="sidebar-link" data-module="partes">
                    <i class="fas fa-file-signature"></i>
                    <span>Partes Diarios</span>
                </a>
                <a href="#/tareas" class="sidebar-link" data-module="tareas">
                    <i class="fas fa-tasks"></i>
                    <span>Tareas</span>
                </a>
                <a href="#/usuarios" class="sidebar-link" data-module="usuarios">
                    <i class="fas fa-user-shield"></i>
                    <span>Usuarios</span>
                </a>
                <a href="#/calendario" class="sidebar-link" data-module="calendario">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Calendario</span>
                </a>
            </nav>
        </aside>

        <!-- ─── Main Content ───────────────────────── -->
        <main class="main-content" id="app-content">
            <div class="loading-spinner">
                <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                <p>Cargando...</p>
            </div>
        </main>
    </div>

    <!-- ─── Scripts (order matters) ────────────── -->
    <script>
        // Global config — Same-origin in Docker/Render (API_URL = '')
        // For local XAMPP dev, uncomment the line below:
        // API_URL: 'http://localhost/APP-Prueba/backend/public',
        window.APP_CONFIG = {
            API_URL: '',
            VERSION: '2.0.0',
        };
    </script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/app.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('[SW] Registered:', reg.scope))
                .catch(err => console.warn('[SW] Registration failed:', err));
        }
    </script>
</body>

</html>